<!--
Copyright 2013 Roy Russo

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Latest Builds: https://github.com/royrusso/elasticsearch-HQ
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="css/elastichq.css" rel="stylesheet" media="screen">
    <link href="css/font-awesome.css" rel="stylesheet" media="screen">
    <!--[if IE 7]>
    <link rel="stylesheet" href="css/excanvas-ie7.min.css">
    <![endif]-->
</head>
<body>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="http://www.elastichq.org"><i class="icon-dashboard"></i> Elastic HQ</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li>
                        <form class="form-search" style="margin:0;padding: 0;" id="connform_top">
                            <div class="input-prepend input-append" style="width: 300px;padding-top: 5px;">
                                <span class="add-on"><i class="icon-sitemap"></i></span>
                                <input type="text" placeholder="Enter REST URL..." name="connectionURL"
                                       style="width: 250px;"
                                       id="connectionURL">
                                <button class="btn btn-info" type="button" id="connectButton">Connect</button>
                            </div>
                        </form>
                    </li>
                </ul>
                <ul class="nav pull-right">
                    <a class="btn btn-success" href="https://github.com/royrusso/elasticsearch-HQ"><i
                            class="icon-github icon-large"></i> Star us on GitHub</a>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </div>
</div>

<div id="error-loc"></div>

<div class="container-fluid">

    <div class="row-fluid">
        <div class="pull-left span7" id="clusterHealth-loc" style="padding-bottom: 8px;">
        </div>

        <div id="toolbar" style="padding:0;margin:0;visibility: hidden;">
            <div class="btn-group pull-right ">
                <button class="btn btn-large" rel="tipRight" data-placement="bottom"
                        data-title="Administration & Configuration"><i
                        class="icon-cogs"></i></button>
                <button class="btn btn-large" rel="tipRight" data-placement="bottom" data-title="Indices"><i
                        class="icon-list"></i>
                </button>
                <button class="btn btn-large" rel="tipRight" data-placement="bottom"
                        data-title="Query the Cluster."><i
                        class="icon-search"></i></button>
            </div>
        </div>
    </div>

    <div class="row-fluid" style="padding:0;margin:0;">
        <div class="pull-left" id="nodeList-loc" style="padding-bottom: 8px;"></div>
    </div>
</div>

<ul class="nav nav-list">
    <li class="divider"></li>
</ul>

<div id="workspace" class="container-fluid">
    <div class="row-fluid">

        <div id="clusterHealthModal">
            <script type="text/template" id="clusterHealth-modal-template">
                <h3>Cluster Health:</h3>

                <div class="span5 center-table">
                    <table class="table table-striped table-hover table-bordered  center-table">
                        <!--
                                                <caption><h4>Cluster Health</h4></caption>
                        -->
                        <!--                        <thead>
                                                <tr>
                                                    <th>qqq</th>
                                                    <th>www</th>
                                                </tr>
                                                </thead> -->
                        <tr>
                            <td>Status</td>
                            <td><span style="color:<%- status %>"><i class="icon-circle icon-large"></i></span></td>
                        </tr>
                        <tr>
                            <td>Timed Out?</td>
                            <td><%- timed_out %></td>
                        </tr>
                        <tr>
                            <td># Nodes</td>
                            <td><%-number_of_nodes %></td>
                        </tr>
                        <tr>
                            <td># Data Nodes</td>
                            <td><%-number_of_data_nodes %></td>
                        </tr>
                        <tr>
                            <td>Active Primary Shards</td>
                            <td><%-active_primary_shards %></td>
                        </tr>
                        <tr>
                            <td>Active Shards</td>
                            <td><%- active_shards%></td>
                        </tr>
                        <tr>
                            <td>Reloacting Shards</td>
                            <td><%- relocating_shards%></td>
                        </tr>
                        <tr>
                            <td>Initializing Shards</td>
                            <td><%- initializing_shards%></td>
                        </tr>
                        <tr>
                            <td>Unassigned Shards</td>
                            <td><%- unassigned_shards%></td>
                        </tr>
                    </table>
                </div>
            </script>
        </div>

    </div>
</div>


<div class="chart-container">
    <div id="placeholder" class="chart-placeholder"></div>
    <div id="legend"></div>
</div>

<script src="js/lib/jquery/jquery.1.9.1.min.js"></script>
<script src="js/lib/bootstrap/bootstrap.min.js"></script>
<script src="js/lib/underscore/underscore.js"></script>
<script src="js/lib/backbone/backbone.js"></script>
<script src="js/elastichq.js"></script>

<!-- Templates -->
<script src="js/template/ClusterTemplates.js"></script>
<script src="js/template/NodeTemplates.js"></script>
<script src="js/template/MessageTemplate.js"></script>

<!-- Models -->
<script src="js/model/ModelUtil.js"></script>
<script src="js/model/ErrorMessageModel.js"></script>
<script src="js/model/cluster/ClusterHealthModel.js"></script>
<script src="js/model/node/NodeSimpleModel.js"></script>
<script src="js/model/node/NodeListModel.js"></script>
<script src="js/model/node/NodesInfoListModel.js"></script>

<!-- View -->
<script src="js/view/cluster/ClusterHealthView.js"></script>
<script src="js/view/node/NodeListView.js"></script>
<script src="js/view/ErrorMessageView.js"></script>

<!-- Util -->
<script src="js/util/logger.js"></script>

<!-- Charts -->
<script language="javascript" type="text/javascript" src="js/lib/flot/jquery.flot.js"></script>
<script type="text/javascript">

    $(function () {

        // We use an inline data source in the example, usually data would
        // be fetched from a server

        var data = [],
                totalPoints = 300;

        function getRandomData() {

            if (data.length > 0)
                data = data.slice(1);

            // Do a random walk

            while (data.length < totalPoints) {

                var prev = data.length > 0 ? data[data.length - 1] : 50,
                        y = prev + Math.random() * 10 - 5;

                if (y < 0) {
                    y = 0;
                } else if (y > 100) {
                    y = 100;
                }

                data.push(y);
            }

            // Zip the generated y values with the x values

            var res = [];
            for (var i = 0; i < data.length; ++i) {
                res.push([i, data[i]])
            }

            return res;
        }

        // Set up the control widget

        var updateInterval = 30;
        $("#updateInterval").val(updateInterval).change(function () {
            var v = $(this).val();
            if (v && !isNaN(+v)) {
                updateInterval = +v;
                if (updateInterval < 1) {
                    updateInterval = 1;
                } else if (updateInterval > 2000) {
                    updateInterval = 2000;
                }
                $(this).val("" + updateInterval);
            }
        });

        var plot = $.plot("#placeholder", [ getRandomData() ], {
            grid:{
                borderWidth:1,
                minBorderMargin:20,
                labelMargin:10,
                backgroundColor:{
                    colors:["#fff", "#e4f4f4"]
                },
                margin:{
                    top:8,
                    bottom:20,
                    left:20
                },
                markings:function (axes) {
                    var markings = [];
                    var xaxis = axes.xaxis;
                    for (var x = Math.floor(xaxis.min); x < xaxis.max; x += xaxis.tickSize * 2) {
                        markings.push({ xaxis:{ from:x, to:x + xaxis.tickSize }, color:"rgba(232, 232, 255, 0.2)" });
                    }
                    return markings;
                }
            },
            series:{
                shadowSize:0    // Drawing is faster without shadows
            },
            yaxis:{
                show:true,
                min:0,
                max:100
            },
            xaxis:{
                show:true
            },
            legend:{
                show:true,
                container:'legend'
            }
        });

        // Create the demo X and Y axis labels

        var yaxisLabel = $("<div class='axisLabel yaxisLabel'></div>")
                .text("Response Time (ms)")
                .appendTo($('#placeholder'));

        function update() {

            plot.setData([getRandomData()]);

            // Since the axes don't change, we don't need to call plot.setupGrid()

            plot.draw();
            setTimeout(update, updateInterval);
        }

        update();

        // Add the Flot version string to the footer

        $("#footer").prepend("Flot " + $.plot.version + " &ndash; ");
    });

</script>

<script>
    $(document).ready(function () {
        $('#connectionURL').focus();

        $("[rel=tipRight]").tooltip(
                {
                    'animation':true
                }

        );
        $("[rel=popRight]").popover(
                {
                    'trigger':'hover',
                    'animation':true
                }
        );
    });
</script>
</body>
</html>